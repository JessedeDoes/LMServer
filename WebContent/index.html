<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--
Look at
https://developers.google.com/chart/interactive/docs/gallery/annotatedtimeline?csw=1
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>LM server demo</title>
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css">
<style type="text/css">
.modelTable { padding: 4pt; border-style: solid; border-collapse: collapse; border-width: 1px } 
.datatable {border-style:solid; border-collapse:collapse; background-color:white; padding:4pt }
.button-link {
    [...]
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    border: solid 1px #20538D;
    text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.4);
    -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4), 0 1px 1px rgba(0, 0, 0, 0.2);
    -moz-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4), 0 1px 1px rgba(0, 0, 0, 0.2);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4), 0 1px 1px rgba(0, 0, 0, 0.2);
}

#header { background-image: url(http://transcriptorium.eu/wp-content/themes/OpenBiz/images/background.png) }
</style>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script>

<script type="text/JavaScript">
 $(function() {
$( "#tabs" ).tabs();
});

function hide_element(element_id)
{
  var h = document.getElementById(element_id);
  h.style.display = 'none';
}

function show_element(element_id)
{
  var h = document.getElementById(element_id);
  h.style.display = 'block';
}

function toggle_element(element_id)
{
  var h = document.getElementById(element_id);
  if (h.style.display == 'block')
  {
    h.style.display = 'none';
  } else
  {
    h.style.display = 'block';
  }
}

/*
function getData()
{
  var queryString  = $('form').serialize();
   
  $.ajax(
  {
    type:"GET",
    dataType: "text",
    contentType: "text/plain",
    url: "http://svprre02:8080/LMServer/LMServer?"  + queryString, 
    success: function(data) { handleResponse(data); },
    error: function(xhr, statusText) { alert(statusText); },
  });
}

function handleResponse(data)
{
  var rLines = data.split("\n");
  var tLines = document.getElementById("text").value.split("\n");
  var response = document.getElementById('response');
  response.innerHTML="";
  $.each(rLines, function (k, line)
  {
     var tLine = tLines[k];
     var rparts = line.split("\|");
     var id=rparts[0];
     var tparts = tLine.split("\|");
     var candidates = rparts[1].split(" ");
     //alert(tLine + " " + line);
     response.innerHTML += id + ": " + tparts[1] + " <i>{" + candidates + "}</i><br>";
  });
}
*/

function buildAndListModels()
{
  var queryString  = $('uploadForm').serialize();
  alert(queryString); 
  $.ajax(
  {
    type:"POST",
    dataType: "json",
    contentType: "application/json",
    url: "http://svprre02:8080/LMServer/LMServer?"  + queryString, 
    success: function(data) { reloadModelList(); },
    error: function(xhr, statusText) { alert(statusText); },
  });
}

function reloadModelList()
{

   var lmList = document.getElementById("lm");
   var modelTable = document.getElementById("modelTable");
   lmList.innerHTML = "";
   modelTable.innerHTML="";
   var jsonURL = "http://svprre02:8080/LMServer/LMServer?action=LIST_LMS";
   $.ajax(
   {
     type:"GET",
     dataType: "json",
     contentType: "application/json",
     url: jsonURL,

     success: function(data) 
     {
        var s = "";
        //alert(data); 
        $.each(data, function(k,e)
        {
          var opt = document.createElement('option');
            opt.name = k,
            opt.value = k;
            opt.innerHTML = e;
            lmList.appendChild(opt);
          var row = document.createElement('tr');
            var col1 = document.createElement('td');
            var col2 = document.createElement('td');
            col1.setAttribute('class','modelTable') ;
            col2.setAttribute('class','modelTable'); 
            modelTable.appendChild(row);
            row.appendChild(col1); 
            row.appendChild(col2); 
            col1.innerHTML = k; col2.innerHTML = e;
        });
     },
     error: function(xhr, statusText) { alert(statusText); },
   }); 
} 

function getSuggestions(left, pattern)
{
   var lm = document.getElementById("lm").value;
   var jsonURL = "http://svprre02:8080/LMServer/LMServer?action=SUGGESTION&lm=" + lm + "&left="  + left + "&pattern=" + pattern + ".*";
   $.ajax(
   {
     type:"GET",
     dataType: "json",
     contentType: "application/json",
     url: jsonURL,

     success: function(data) 
     {
        var s = "";
        //alert(data); 
        $.each(data.entries, function(k,e)
        {
          if (e.word.match(/[A-Za-z0-9-]/) && !e.word.match(/</))
             s += e.word.toLowerCase() + "<br>"; 
        });
         
        document.getElementById('response').innerHTML = s;
        document.getElementById('url').setAttribute('href', jsonURL);
     },
     error: function(xhr, statusText) { alert(statusText); },
   }); 
}

function suggest()
{
  var t = document.getElementById('text');
  var s = t.selectionStart;
  var txt = t.value;
  var before = txt.substring(0,s);
  var parts = before.split(/\s+/);
  //alert('<' + before + '>: ' + parts);

  var last = parts[parts.length-1];
  var leftContext = parts.slice(0,parts.length-1); 
  var left = leftContext.join(" ");

  getSuggestions(left,last);
}
</script>
</head>




<div id="header">
        <div class="logo">
            <a href="http://transcriptorium.eu"><img src="http://transcriptorium.eu/wp-content/uploads/2013/09/Brand_tranScriptorium-622.png" alt="tranScriptorium" title="tranScriptorium"></a>
        </div>
	<span style="text-align: right">Language resource server prototype</span>
</div>


<div id="tabs">
<ul>
  <li><a href="#tabs-1">Build model</a>
  <li><a href="#tabs-2">Decode word graph</a>
  <li><a href="#tabs-3">Try out model</a>
</ul>

<div id="tabs-1">
<form method='post' id='uploadForm'  enctype="multipart/form-data"  action="http://svprre02:8080/LMServer/LMServer" target="console">
<input type='hidden' name='action' value='BUILD_LM'>
<input type='file' name='sourceFile'>
<input name='name' type='text' value='myUpload'>
<input type='text' name='description' value=' -- please describe --'>
<input type="submit" value="Submit form to build model">
</form>
<table id='modelTable'>
</table>
</div>
<div id="tabs-2">
<form method='post' id='decodeForm'  enctype="multipart/form-data"  action="http://svprre02:8080/LMServer/LMServer" target="console">
LM: <select id="lm2" name="lm">
<option value="Bentham">Bentham with ECCO out-of-domain data</option>
<option value="Reichsgericht">Reichsgericht (including OCR of book)</option>
<option value="Plantas">Plantas weakly interpolated with Gutenberg Spanish</option>
<option value="SpanishGutenberg">Gutenberg Spanish books</option>
<option value="MNL">General (literary) Middle Dutch Corpus</option>
</select><br>
<input type='hidden' name='action' value='DECODE_WG'><br>
<input type='file' name='lattice' multiple='multiple'><br>
Show word graphs: <input type='checkbox' name='showWG'><br>
<input type="submit" value="Decode">
</form>
</div>

<div id="tabs-3">
<form id='theform' accept-charset="UTF-8" method="POST" target="_blank" action="http://svprre02:8080/LMServer/LMServer">
LM: <select id="lm" name="lm">
<option value="Bentham">Bentham with ECCO out-of-domain data</option>
<option value="Reichsgericht">Reichsgericht (including OCR of book)</option>
<option value="Plantas">Plantas weakly interpolated with Gutenberg Spanish</option>
<option value="SpanishGutenberg">Gutenberg Spanish books</option>
<option value="MNL">General (literary) Middle Dutch Corpus</option>
</select>
<!--
<span onclick="reloadModelList()">Refresh Model List</span>
-->
<p>
<table>
<tr valign='top'>
<td width='100px'>
<div id='response' width='100px' style='background-color: #eeeeff; text-transformation: lowercase'></div>
</td>
<td>
<textarea onkeyup="suggest()" name="text" id="text" rows=10 cols=100> </textarea>
</td>
</tr>
</table>
<span class='button-link' id='showUrl'><a target="console" id='url'>Show JSON</a></span>
</form>
</div>
</div>
<button onClick="reloadModelList()">Refresh Model List</button>

<div width='100%' style='background-color: white'> 
<iframe width='100%' height='800px' name='console'></iframe>
</div>
</body>
</html>
